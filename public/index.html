<html>
<head>
    <title>Ear training App</title>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="stylesheet" href="/stylesheets/style.css" />
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.0.0/mdb.min.css" />

    <style>
        .hide {display: none;}
        .key {
            float: left;
            width: 40px;
            height: 200px;
            background-color: white;
            border: 1px solid black;
            /* display: inline-block; */
            margin: 4px;
            cursor: pointer;
        }

        .black-key {
            float: left;
            width: 30px;
            height: 120px;
            background-color: black;
            position: relative;
            margin-top: 4px;
            margin-left: -29px;
            cursor: pointer;
        }

        .active.right {
          background: lightgreen;
        }

        .active.wrong {
          background: red;
        }
    </style>
</head>

  <body>

    
<div class="hide">
    <h1 class="text-center" id="todo">Express + Prisma + MongoDB</h1>
    <h2 class="text-center">To Do List</h2>

    <section style="background-color:rgb(3 0 244 / 6%);">
      <div class="container-lg p-4">
        <div class="row d-flex justify-content-center align-items-center">
          <div class="col col-xl-10">

            <div class="card">
              <div class="card-body p-4">

                <form class="d-flex justify-content-center align-items-center mb-3" id="todo-form">
                  <div class="form-outline flex-fill">
                    <input type="text" id="add-input" class="form-control" />
                    <label class="form-label" for="add-input">New task...</label>
                  </div>
                  <button type="submit" class="btn btn-info ms-2">Add</button>
                </form>

                <ul class="list-group mb-0" id="todo-list" />

              </div>
            </div>

          </div>
        </div>
      </div>
    </section>
  </div>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.0.0/mdb.min.js" ></script>
    <script type="text/javascript" src="../js/client.js" ></script>


     <div class="piano_zone">
         <h2>PIANO</h2>
         <div class="content">
              <div class="song" data-note="A#">Bohemian Rhapsody</div>
              <audio data-sound="A#" src="pianoSongs/bohemianRhapsody.mp3"></audio>

             <div class="key" data-note="C3"></div>
             <div class="black-key" data-note="C#3"></div>
             <div class="key" data-note="D3"></div>
             <div class="black-key" data-note="D#3"></div>
             <div class="key" data-note="E3"></div>
             <div class="key" data-note="F3"></div>
             <div class="black-key" data-note="F#3"></div>
             <div class="key" data-note="G3"></div>
             <div class="black-key" data-note="G#3"></div>
             <div class="key" data-note="A3"></div>
             <div class="black-key" data-note="A#3"></div>
             <div class="key" data-note="B3"></div>

             <audio data-sound="C3" src="pianomp3/C3.mp3"></audio>
             <audio data-sound="C#3" src="pianomp3/Db3.mp3"></audio>
             <audio data-sound="D3" src="pianomp3/D3.mp3"></audio>
             <audio data-sound="D#3" src="pianomp3/Eb3.mp3"></audio>
             <audio data-sound="E3" src="pianomp3/E3.mp3"></audio>
             <audio data-sound="F3" src="pianomp3/F3.mp3"></audio>
             <audio data-sound="F#3" src="pianomp3/Gb3.mp3"></audio>
             <audio data-sound="G3" src="pianomp3/G3.mp3"></audio>
             <audio data-sound="G#3" src="pianomp3/Ab3.mp3"></audio>
             <audio data-sound="A3" src="pianomp3/A3.mp3"></audio>
             <audio data-sound="A#3" src="pianomp3/Bb3.mp3"></audio>
             <audio data-sound="B3" src="pianomp3/B3.mp3"></audio>

             <div class="key" data-note="C4"></div>
             <div class="black-key" data-note="C#4"></div>
             <div class="key" data-note="D4"></div>
             <div class="black-key" data-note="D#4"></div>
             <div class="key" data-note="E4"></div>
             <div class="key" data-note="F4"></div>
             <div class="black-key" data-note="F#4"></div>
             <div class="key" data-note="G4"></div>
             <div class="black-key" data-note="G#4"></div>
             <div class="key" data-note="A4"></div>
             <div class="black-key" data-note="A#4"></div>
             <div class="key" data-note="B4"></div>

             <audio data-sound="C4" src="pianomp3/C4.mp3"></audio>
             <audio data-sound="C#4" src="pianomp3/Db4.mp3"></audio>
             <audio data-sound="D4" src="pianomp3/D4.mp3"></audio>
             <audio data-sound="D#4" src="pianomp3/Eb4.mp3"></audio>
             <audio data-sound="E4" src="pianomp3/E4.mp3"></audio>
             <audio data-sound="F4" src="pianomp3/F4.mp3"></audio>
             <audio data-sound="F#4" src="pianomp3/Gb4.mp3"></audio>
             <audio data-sound="G4" src="pianomp3/G4.mp3"></audio>
             <audio data-sound="G#4" src="pianomp3/Ab4.mp3"></audio>
             <audio data-sound="A4" src="pianomp3/A4.mp3"></audio>
             <audio data-sound="A#4" src="pianomp3/Bb4.mp3"></audio>
             <audio data-sound="B4" src="pianomp3/B4.mp3"></audio>

             <script>
                 const keys = document.querySelectorAll('.key, .black-key');

                 const songs = document.querySelectorAll('.song');
                 
                 /*{bohemianRhapsody: 'A#', gravityJohnMayer: 'G'}
*/


                 function playSound(note) {
                     const audio = document.querySelector(`audio[data-sound="${note}"]`);
                     if (!audio) return;
                     audio.currentTime = 0;
                     audio.play();
                 }

                 function playSong(note) {
                     const audio = document.querySelector(`audio[data-sound="${note}"]`);
                     if (!audio) return;
                     audio.currentTime = 0;
                     audio.play();
                     setTimeout(function (){

                      audio.pause();
                      const songPlaying = document.querySelector('div.playing');
                      songPlaying.classList.remove('playing');
                      }, 30000);
                 }

                 function stopSong(note) {
                    const audio = document.querySelector(`audio[data-sound="${note}"]`);
                    audio.pause();
                 }

                 songs.forEach(song => {
                    song.addEventListener('mousedown', () => {
                      const note = song.dataset.note;
                      playSong(note);
                      song.classList.add('playing');
                    });
                 });

                 keys.forEach(key => {
                    
                     key.addEventListener('mousedown', () => {
                      const currentSong = document.querySelector('div.playing');
                         const note = key.dataset.note;
                         playSound(note);
                         key.classList.add('active');

                      if(currentSong != null) {
                        const currentKey = currentSong.dataset.note;
                        if(note.slice(0,-1) == currentKey) {
                          key.classList.add('right');
                          console.log("WIN WIN WIN!");
                          stopSong(currentKey);
                          alert("YOU GOT IT! IT'S "+currentKey);
                         } else {
                          key.classList.add('wrong');
                          console.log("LOSE LOSE LOSE!");
                          console.log(note, currentKey);
                         }
                      }


                        
                     });

                     key.addEventListener('mouseup', () => {
                         key.classList.remove('active');
                     });

                     key.addEventListener('mouseleave', () => {
                         key.classList.remove('active');
                     });

                     key.addEventListener('touchstart', (event) => {
                         const note = key.dataset.note;
                         playSound(note);
                         key.classList.add('active');
                         event.preventDefault();
                     });

                     key.addEventListener('touchend', () => {
                         key.classList.remove('active');
                     });
                 });

                 window.addEventListener('keydown', (event) => {
                     const key = event.key.toUpperCase();
                     const keyElement = document.querySelector(`.key[data-note="${key}"]`);
                     if (!keyElement) return;
                     const note = keyElement.dataset.note;
                     playSound(note);
                     keyElement.classList.add('active');
                 });

                 window.addEventListener('keyup', (event) => {
                     const key = event.key.toUpperCase();
                     const keyElement = document.querySelector(`.key[data-note="${key}"]`);
                     if (!keyElement) return;
                     keyElement.classList.remove('active');
                 });
             </script>

         </div>
     
     
     </div>
  </body>
</html>
