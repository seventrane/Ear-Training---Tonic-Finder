<html>
<head>
    <title>Ear training App</title>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="stylesheet" href="stylesheets/style.css" />
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.0.0/mdb.min.css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <style>
       /*local style*/

       /* SLIDER SWITCH STYLES */

       .switch {
          position: relative;
          display: inline-block;
          width: 60px;
          height: 34px;
        }

        .switch input { 
          opacity: 0;
          width: 0;
          height: 0;
        }

        .slider {
          position: absolute;
          cursor: pointer;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: #ccc;
          -webkit-transition: .4s;
          transition: .4s;
        }

        .slider:before {
          position: absolute;
          content: "";
          height: 26px;
          width: 26px;
          left: 4px;
          bottom: 4px;
          background-color: white;
          -webkit-transition: .4s;
          transition: .4s;
        }

        input:checked + .slider {
          background-color: #2196F3;
        }

        input:focus + .slider {
          box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
          -webkit-transform: translateX(26px);
          -ms-transform: translateX(26px);
          transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
          border-radius: 34px;
        }

        .slider.round:before {
          border-radius: 50%;
        }


    </style>
</head>

  <body>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.0.0/mdb.min.js" ></script>
    <script type="text/javascript" src="js/client.js" ></script>

     <div class="piano_zone">
         <div class="content clearfix">
            <h2>EAR TRAINING - TONIC FINDER</h2>
            
            <div class="btnsWrapper">
              <div class="stop_music hide">Stop Music</div>
              <div class="start_music hide">Start Music</div>
              <div class="start_game">Start Game</div>
              <div class="next_music hide">Next Song</div>
              <div class="repeat_music hide">Repeat Song</div>
            </div>

            <div class="songsWrapper" style="">
              <div class="song" data-song="1" data-note="A#">
                Bohemian Rhapsody
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="1" src="pianoSongs/bohemianRhapsody.mp3"></audio>

              <div class="song" data-song="2" data-note="G">
                Gravity John Mayer
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="2" src="pianoSongs/gravityJohnmayer.mp3"></audio>

              <div class="song" data-song="3" data-note="A#">
                Purple Rain Prince
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="3" src="pianoSongs/purpleRainPrince.mp3"></audio>

              <div class="song" data-song="4" data-note="A">
                September EWF
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="4" src="pianoSongs/septemberEWF.mp3"></audio>

              <div class="song" data-song="5" data-note="A">
                Stairway to Heaven Led Zeppelin
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="5" src="pianoSongs/stairwayToHeavenLed.mp3"></audio>

              <div class="song" data-song="6" data-note="F#">
                Billie Jean Michael Jackson
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="6" src="pianoSongs/billieJeanMJ.mp3"></audio>

              <div class="song" data-song="7" data-note="F#">
                Wonderwall Oasis
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="7" src="pianoSongs/wonderwallOasis.mp3"></audio>

              <div class="song" data-song="8" data-note="F">
                Happy Pharrell Williams
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="8" src="pianoSongs/happyPharell.mp3"></audio>

              <div class="song" data-song="9" data-note="A">
                Someone Like You Adele
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="9" src="pianoSongs/someoneLikeYouAdele.mp3"></audio>

              <div class="song" data-song="10" data-note="B">
                Hotel California The Eagles
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="10" src="pianoSongs/hotelCaliforniaEagles.mp3"></audio>

              <div class="song" data-song="11" data-note="C">
                All The Smalls Things Blink 182
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="11" src="pianoSongs/allTheSmallThingsBlink182.mp3"></audio>

              <div class="song" data-song="12" data-note="F" data-quality="minor">
                Smells Like Teen Spirit
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="12" src="pianoSongs/smellsLikeTeenSpiritNirvana.mp3"></audio>
              
              <div class="song" data-song="13" data-note="C" data-quality="major">
                Build Me Up Butter Cup                
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="13" src="pianoSongs/BuildMeUpButterCup.mp3"></audio>
                      
              <div class="song" data-song="14" data-note="G" data-quality="major">
                Creep Radiohead              
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="14" src="pianoSongs/creepRadiohead.mp3"></audio>

              <div class="song" data-song="15" data-note="G" data-quality="major">
                Blackbird The Beatles     
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="15" src="pianoSongs/blackbirdBeatles.mp3"></audio>

              <div class="song" data-song="16" data-note="G" data-quality="major">
                Wish You Were Here Floyd
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="16" src="pianoSongs/wishYouWereHereFloyd.mp3"></audio>

              <div class="song" data-song="17" data-note="A" data-quality="minor">
                On The Beach Neil Young
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="17" src="pianoSongs/onTheBeachNeilYoung.mp3"></audio>



              

              <div></div>
            </div>

            <div class="keysWrapper">
              <div data-note="C">C</div>
              <div data-note="C#">C#/Db</div>
              <div data-note="D">D</div>
              <div data-note="D#">D#/Eb</div>
              <div data-note="E">E</div>
              <div data-note="F">F</div>
              <div data-note="F#">F#/Gb</div>
              <div data-note="G">G</div>
              <div data-note="G#">G#/Ab</div>
              <div data-note="A">A</div>
              <div data-note="A#">A#/Bb</div>
              <div data-note="B">B</div>
            </div>

            <div class="piano">
                <div class="key" data-note="C3"></div>
                <div class="black-key" data-note="C#3"></div>
                <div class="key" data-note="D3"></div>
                <div class="black-key" data-note="D#3"></div>
                <div class="key" data-note="E3"></div>
                <div class="key half" data-note="F3"></div>
                <div class="black-key" data-note="F#3"></div>
                <div class="key" data-note="G3"></div>
                <div class="black-key" data-note="G#3"></div>
                <div class="key" data-note="A3"></div>
                <div class="black-key" data-note="A#3"></div>
                <div class="key" data-note="B3"></div>

                <audio preload="auto" data-sound="C3" src="pianomp3/jobro/C3.wav"></audio>
                <audio preload="auto" data-sound="C#3" src="pianomp3/jobro/Db3.wav"></audio>
                <audio preload="auto" data-sound="D3" src="pianomp3/jobro/D3.wav"></audio>
                <audio preload="auto" data-sound="D#3" src="pianomp3/jobro/Eb3.wav"></audio>
                <audio preload="auto" data-sound="E3" src="pianomp3/jobro/E3.wav"></audio>
                <audio preload="auto" data-sound="F3" src="pianomp3/jobro/F3.wav"></audio>
                <audio preload="auto" data-sound="F#3" src="pianomp3/jobro/Gb3.wav"></audio>
                <audio preload="auto" data-sound="G3" src="pianomp3/jobro/G3.wav"></audio>
                <audio preload="auto" data-sound="G#3" src="pianomp3/jobro/Ab3.wav"></audio>
                <audio preload="auto" data-sound="A3" src="pianomp3/jobro/A3.wav"></audio>
                <audio preload="auto" data-sound="A#3" src="pianomp3/jobro/Bb3.wav"></audio>
                <audio preload="auto" data-sound="B3" src="pianomp3/jobro/B3.wav"></audio>

                <div class="key half" data-note="C4"></div>
                <div class="black-key" data-note="C#4"></div>
                <div class="key" data-note="D4"></div>
                <div class="black-key" data-note="D#4"></div>
                <div class="key" data-note="E4"></div>
                <div class="key half" data-note="F4"></div>
                <div class="black-key" data-note="F#4"></div>
                <div class="key" data-note="G4"></div>
                <div class="black-key" data-note="G#4"></div>
                <div class="key" data-note="A4"></div>
                <div class="black-key" data-note="A#4"></div>
                <div class="key" data-note="B4"></div>

                <audio preload="auto" data-sound="C4" src="pianomp3/jobro/C4.wav"></audio>
                <audio preload="auto" data-sound="C#4" src="pianomp3/jobro/Db4.wav"></audio>
                <audio preload="auto" data-sound="D4" src="pianomp3/jobro/D4.wav"></audio>
                <audio preload="auto" data-sound="D#4" src="pianomp3/jobro/Eb4.wav"></audio>
                <audio preload="auto" data-sound="E4" src="pianomp3/jobro/E4.wav"></audio>
                <audio preload="auto" data-sound="F4" src="pianomp3/jobro/F4.wav"></audio>
                <audio preload="auto" data-sound="F#4" src="pianomp3/jobro/Gb4.wav"></audio>
                <audio preload="auto" data-sound="G4" src="pianomp3/jobro/G4.wav"></audio>
                <audio preload="auto" data-sound="G#4" src="pianomp3/jobro/Ab4.wav"></audio>
                <audio preload="auto" data-sound="A4" src="pianomp3/jobro/A4.wav"></audio>
                <audio preload="auto" data-sound="A#4" src="pianomp3/jobro/Bb4.wav"></audio>
                <audio preload="auto" data-sound="B4" src="pianomp3/jobro/B4.wav"></audio>
              </div>

              <div class="settings">
                <div class="announcement">
                  <h3>1. Click Start Game</h3>
                  <h3>2. Use the keyboard to assist you identifying the tonic</h3>
                  <h3>3. Then select the tonic from the letters above the keyboard</h3>
                </div>
                <h4 class="hide">Songs Will Play:</h4>
                <div class="behavior_controls hide">
                  <span>Manual</span>
                  <label class="switch">
                    <input class="switch_check" type="checkbox">
                    <span class="slider round"></span>
                  </label>
                  <span>Auto</span>
                </div>

                <div class="volume_controls">
                  <label class="songVolText">Song Volume: </label>
                  <input class="songVolInput" type="range" id="volume" value="100">
                  
                  <label class="pianoVolText">Piano Volume: </label>
                  <input class="pianoVolInput" type="range" id="volume2" value="100">
                </div>
              </div>

              <script>
                 let globalVol = 0.1;
                 let globalNoteVol = 1;
                 let globalPlayingStyle = 0;
                 let globalSongsPlayed = [];
                 const keys = document.querySelectorAll('.key, .black-key');

                 const songs = document.querySelectorAll('.song');
                 const songKeys = document.querySelectorAll('.keysWrapper > div');
                 const stopBtn = document.querySelector('.stop_music');
                 const btn2 = document.querySelector('.start_game');
                 const btn3 = document.querySelector('.next_music');
                 const repeatBtn = document.querySelector('.repeat_music');
                 const startMusicBtn = document.querySelector('.start_music');

                 $("document").ready(function() {
                    console.log(globalVol);
                    volume.value = globalVol;
                 });

                 volume.addEventListener("input", (e) => {
                    const currentSong = document.querySelector('div.playing');
                    let audio = document.querySelector(`audio[data-sound="${currentSong.dataset.song}"]`);
                     // console.log(e.currentTarget.value);
                    audio.volume = e.currentTarget.value / 100;
                    globalVol = audio.volume;   
                });

                volume.addEventListener("touchmove", (e) => {
                  console.log(e.currentTarget.value);
                  const currentSong = document.querySelector('div.playing');
                    let audio = document.querySelector(`audio[data-sound="${currentSong.dataset.song}"]`);
                     // console.log(e.currentTarget.value);
                    audio.volume = e.currentTarget.value / 100;
                    globalVol = audio.volume;   
                });


                volume2.addEventListener("input", (e) => {
                    const currentKey = document.querySelector('.key');
                    
                    let audio = document.querySelector(`audio[data-sound="${currentKey.dataset.note}"]`);
                    
                    audio.volume = e.currentTarget.value / 100;
                    globalNoteVol = audio.volume;   
                });

                stopBtn.addEventListener('click', () => {
                  const currentSong = document.querySelector('div.playing');
                  stopSong(currentSong.dataset.song);
                  startMusicBtn.classList.remove("hide");
                  stopBtn.classList.add("hide");
                });

                repeatBtn.addEventListener('click', ()=> {
                  const currentSong = document.querySelector('div.activa');
                  playSong(currentSong.dataset.song);

                });

                startMusicBtn.addEventListener('click', ()=> {
                  const currentSong = document.querySelector('div.activa');
                  playSong(currentSong.dataset.song);
                  startMusicBtn.classList.add("hide");
                  stopBtn.classList.remove("hide");
                });

                function randomSong() {
                  if(globalSongsPlayed.length < $(".song").length) {
                     // console.log("CHECKED");
                     btn2.style.display = 'none';
                     btn3.style.display = 'block';
                      var randSong = Math. floor(Math. random()*$(".song").length) + 1;
                      if(globalSongsPlayed.includes(randSong)) {
                        console.log("LENGTH: "+globalSongsPlayed.length);
                        randomSong();
                      } else {
                        playSong(randSong);
                        globalSongsPlayed.push(randSong);
                        console.log("VALIDO");
                        console.log(randSong);

                      }
                    } else {
                      //console.log("NOT CHECKED");
                      globalSongsPlayed.length = 0;
                      console.log("STYLE: "+globalPlayingStyle);
                      btn2.style.display = 'block';
                      btn3.style.display = 'none';
                      //randomSong();
                    }
                }

                btn2.addEventListener('click', () => {
                  console.log("START GAME NOW");
                  
                  randomSong();
                });

                btn3.addEventListener('click', () => {
                 // console.log("START GAME NOW");
                  ///btn2.hide();
                  randomSong();
                  startMusicBtn.classList.add("hide");
                });

                 function playSongAuto() {
                  console.log("PLAYING AUTOMATICALLY");
                 }

                 function playSound(note) {
                  const audio = document.querySelector(`audio[data-sound="${note}"]`);
                     if (!audio) return;
                     audio.currentTime = 0.0;
                    // if (note = 'D') {audio.currentTime = 0.8;}
                     audio.volume = globalNoteVol;
                     audio.play();
                 }

                 function stopSound(note) {
                  
                  /*
                     const audio = document.querySelector(`audio[data-sound="${note}"]`);
                     if (!audio) return;
                     audio.pause();
                 */
                    }

                 function playSong(note) {
                     if (currPlaying = document.querySelector('div.playing')) {
                        stopSong(currPlaying.dataset.song);
                     };
                     
                     const audio = document.querySelector(`audio[data-sound="${note}"]`);
                     if (!audio) return;
                     audio.currentTime = 0;
                     audio.volume = globalVol;
                     audio.play();
                     const songPlaying = document.querySelector(`div[data-song="${note}"]`);
                     const songs = document.querySelectorAll('div.song');
                     const repeatBtn = document.querySelector('div.repeat_music');
                     const stopBtn = document.querySelector('div.stop_music');

                     songs.forEach(song => {
                        song.classList.remove('activa');
                     });

                     songPlaying.classList.add('playing');
                     songPlaying.classList.add('activa');
                     btn2.classList.add('hide');
                     btn3.classList.remove('hide');
                     repeatBtn.classList.remove('hide');
                     stopBtn.classList.remove('hide');
                     setTimeout(function (){
                        audio.pause();
                        songPlaying.classList.remove('playing');
                      }, 30000);
                 }

                 function stopSong(note) {
                    const audio = document.querySelector(`audio[data-sound="${note}"]`);
                    audio.pause();
                    const songPlaying = document.querySelector('div.playing');
                    songPlaying.classList.remove('playing');
                 }

                 songs.forEach(song => {
                    song.addEventListener('mousedown', () => {
                      const note = song.dataset.song;
                      playSong(note);
                    });
                 });

                 songKeys.forEach(key => {
                  key.addEventListener('mousedown', () => {
                      const currentSong = document.querySelector('div.activa');
                      const songPlaying = document.querySelector('div.playing');
                      const note = key.dataset.note;
                  if(currentSong != null) {
                        $(".announcement").hide();
                        $(".settings").addClass("noBanner");
                        const currentKey = currentSong.dataset.note;
                        const song = currentSong.dataset.song;
                        if(note == currentKey) {
                          key.classList.add('right');
                          songKeys.forEach(key1 => {
                            if(key != key1) {key1.classList.remove('wrong');}
                          });
                          if(songPlaying != null) {
                            stopSong(song);
                          }
                          setTimeout(function (){
                              key.classList.remove('right');
                              randomSong();
                          }, 600);
                         } else {
                          key.classList.add('wrong');
                         }
                      }
                 });

                 key.addEventListener('touchstart', () => {
                    /* use if you need something to be only on TOUCH. if nothing here TOUCH uses MOUSEDOWN above*/
                    preventDefault();
                    stopPropagation();
                 });
                });

                 keys.forEach(key => {
                    
                     key.addEventListener('mousedown', () => {
                      const currentSong = document.querySelector('div.playing');
                         const note = key.dataset.note;
                         playSound(note);
                         key.classList.add('active');
                     });

                     key.addEventListener('mouseup', () => {
                         key.classList.remove('active');
                         stopSound(key.dataset.note);
                     });

                     key.addEventListener('mouseleave', () => {
                         key.classList.remove('active');
                        // stopSound(key.dataset.note);
                     });

                     key.addEventListener('touchstart', (event) => {
                         const note = key.dataset.note;
                         playSound(note);
                         key.classList.add('active');
                         event.preventDefault();
                     });

                     key.addEventListener('touchend', () => {
                         key.classList.remove('active');
                         //stopSound(key.dataset.note);
                     });
                 });

                 window.addEventListener('keydown', (event) => {
                     const key = event.key.toUpperCase();
                     const keyElement = document.querySelector(`.key[data-note="${key}"]`);
                     if (!keyElement) return;
                     const note = keyElement.dataset.note;
                     playSound(note);
                     keyElement.classList.add('active');
                 });

                 window.addEventListener('keyup', (event) => {
                     const key = event.key.toUpperCase();
                     const keyElement = document.querySelector(`.key[data-note="${key}"]`);
                     if (!keyElement) return;
                     keyElement.classList.remove('active');
                     // stopSound(key.dataset.note);
                 });

                const checkBox = document.querySelector("input.switch_check");
                checkBox.addEventListener('click', ()=> {
                    if(checkBox.checked) {
                      globalPlayingStyle = 1;
                    } else {
                      globalPlayingStyle = 0
                    }
                    console.log(globalPlayingStyle);
                });


             </script>

         </div>
     </div>
  </body>
</html>
