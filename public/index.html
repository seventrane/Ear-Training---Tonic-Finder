<html>
<head>
    <title>Ear training App</title>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="stylesheet" href="/stylesheets/style.css">
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.0.0/mdb.min.css" />
		  <link rel="stylesheet" href="/dist/style1.css">
		   <link rel="stylesheet" href="/dist/graphiq.css">
		  
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
	
	

  
   <style>
	   /* Local style */
	   /* Toggle Button Style */
	   .toggle-button {
	     appearance: none;
	     background-color: #ccc;
	     border: none;
	     border-radius: 20px;
	     cursor: pointer;
	     height: 24px;
	     outline: none;
	     padding: 2px;
	     position: relative;
	     width: 59px;
	   }
	   
	   .toggle-button.on {
		   background: #ff8533;
	   }

	   .toggle-button::before {
	     background-color: #fff;
	     border-radius: 50%;
	     content: "";
	     height: 20px;
	     left: 2px;
	     position: absolute;
	     top: 2px;
	     transition: transform 0.3s ease-in-out;
	     width: 20px;
	   }

	   .toggle-button.on::before {
	     transform: translateX(35px);
	   }

	   .toggle-button.off::before {
	     transform: translateX(0px);
	   }

	   /* Text Style */
	   .toggle-button span {
	     color: #fff;
	     font-family: Arial, sans-serif;
	     font-size: 12px;
	     position: absolute;
	     top: 50%;
	     transform: translateY(-50%);
	     white-space: nowrap;
	   }
	   
	   .toggle-button.on span.off {
		   display: none;
	   }
	   
	   .toggle-button.on span.on {
		   display: block;
	   }
	   
	   .toggle-button.off span.off {
		   display: block;
	   }
	   
	   .toggle-button.off span.on {
		   display: none;
	   }

	   /* Positioning */
	   .toggle-button span.on {
	     left: 10px;
	   }

	   .toggle-button span.off {
	     right: 10px;
	   }
	   
	   
	   #levelIndicator {
	       position: absolute;
	       left: 76%;
	       top: -39%;
	       font-size: 0.6em; /* Adjust as needed */
	       color: #333; /* Text color */
	       background-color: #fff; /* Background color for the score */
	       padding: 11px 20px 7px; /* Padding around the score */
	       border-radius: 10px; /* Rounded corners */
	       box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Box shadow */
	       text-transform: uppercase;
	   }

	   .topBanner {
	       display: flex;
	       margin: 0px auto 10px;
	       padding: 16px;
	       border-radius: 10px;
	       background-color: #333;
	       color: #fff;
	       box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
	       align-items: baseline;
	       position: relative;
	       max-width: 1024px;
	       width: 100%;
	   }

	   #score {
	       position: absolute;
	       right: 20px; /* Adjust as needed */
	       font-size: 1em; /* Adjust as needed */
	       color: #333; /* Text color */
	       background-color: #fff; /* Background color for the score */
	       padding: 13px 20px 7px; /* Padding around the score */
	       border-radius: 10px; /* Rounded corners */
	       box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); /* Box shadow */
	       text-transform: uppercase;
	   }

	   #loginForms,
	   #registerForm {
	       width: 80%;
	       display: flex;
	       align-items: baseline;
	   }

	   #loginForms form,
	   #registerForm form {
	       /* width: 45%; Adjust as needed */
	       display: flex;
	       column-gap: 5px;
	       float: left;
	       margin-right: 10px;
	       margin-bottom: 0;
	   }

	   #loginForms p,
	   #registerForm p,
	   #loggedInArea p {
	       margin: 0;
	       display: inline-block;
	   }

	   input[type="text"],
	   input[type="password"],
	   button {
	       /* margin-bottom: 10px; */
	       padding: 10px;
	       border: none;
	       border-radius: 5px;
	   }

	   button {
	       background-color: #ff6600; /* Button background color */
	       color: #fff; /* Button text color */
	       cursor: pointer;
	   }

	   button:hover {
	       background-color: #ff8533; /* Button background color on hover */
	   }

	   a {
	       color: #ff6600; /* Link color */
	       text-decoration: none;
	   }

	   a:hover {
	       text-decoration: underline; /* Underline link on hover */
	   }

	   #userManagement {
	       padding: 2px;
	       border: 1px solid #ccc;
	       border-radius: 5px;
	       background-color: #f9f9f9;
	       margin-bottom: 20px;
	       display: none;
	       width: 41%;
	   }

	   #userList {
	       margin-top: 10px;
	   }

	   .user {
	       margin-bottom: 5px;
	   }

	   .delete-btn {
	       margin-left: 10px;
	       cursor: pointer;
	   }
	   
	   #message {
		   line-height: 2.9;
	   }
	   
	   .filterZone {
		   padding: 2%;
		   padding-left: 10%;
	   }
	   
	   .tag {
	      padding: 2px 10px;
	      border: 1px dashed #3498db;
	      background-color: transparent;
	      color: #fff;
	      font-size: 16px;
	      cursor: pointer;
	      border-radius: 5px;
	      outline: none;
	      transition: background-color 0.3s;
	      margin-bottom: 5px;
		  float: right;
		  margin-right: 5px;
		  position: relative;
	    }
	    .tag.active {
	      background-color: #3498db;
	    }
		
		.tag:hover {
			background-color: #3498db;
		}
		
		.music-box {
			float: left;
		}
		
		.tagLabel {
			border: none;
			background: transparent;
			    float: left;
			    color: #3498db;
			    font-weight: 900;
			    padding-left: 4%;
		}
		
		.container {
			visibility: hidden;
			width: 100%!important;
			//margin-top: -73%;
		}
		
		.visible {
			visibility: visible;
			margin-top: 20px!important;
		}
    </style>
	
</head>

  <body>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.0.0/mdb.min.js" ></script>
    <script type="text/javascript" src="/js/client.js" ></script>
	<script src="js/soundmanager2-nodebug.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script type="text/javascript" src="/js/soundmanager2-nodebug.js" ></script>
	<script src="/js/graphiq.min.js"></script>
	

    <script>
        soundManager.setup({
        // url: '',
        // flashVersion: 9, // optional: shiny features (default = 8)
         // optional: ignore, // Flash where possible, use 100% HTML5 mode
          preferFlash: false,
          onready: function() {
            // Ready to use; soundManager.createSound() etc. can now be called.
            soundManager.createSound({
              url: ["pianomp3/jobro/C3.wav"],
              id: "C3",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/Db3.wav"],
              id: "Db3",
              autoLoad: true
            });
            
            soundManager.createSound({
              url: ["pianomp3/jobro/D3.wav"],
              id: "D3",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/Eb3.wav"],
              id: "Eb3",
              autoLoad: true
            });
            soundManager.createSound({
              url: ["pianomp3/jobro/E3.wav"],
              id: "E3",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/F3.wav"],
              id: "F3",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/Gb3.wav"],
              id: "Gb3",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/G3.wav"],
              id: "G3",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/Ab3.wav"],
              id: "Ab3",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/A3.wav"],
              id: "A3",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/Bb3.wav"],
              id: "Bb3",
              autoLoad: true
            });
            
            soundManager.createSound({
              url: ["pianomp3/jobro/B3.wav"],
              id: "B3",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/C4.wav"],
              id: "C4",
              autoLoad: true
            });
            soundManager.createSound({
              url: ["pianomp3/jobro/Db4.wav"],
              id: "Db4",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/D4.wav"],
              id: "D4",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/Eb4.wav"],
              id: "Eb4",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/E4.wav"],
              id: "E4",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/F4.wav"],
              id: "F4",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/Gb4.wav"],
              id: "Gb4",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/G4.wav"],
              id: "G4",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/Ab4.wav"],
              id: "Ab4",
              autoLoad: true
            });
            
            soundManager.createSound({
              url: ["pianomp3/jobro/A4.wav"],
              id: "A4",
              autoLoad: true
            });

            soundManager.createSound({
              url: ["pianomp3/jobro/Bb4.wav"],
              id: "Bb4",
              autoLoad: true
            });
            soundManager.createSound({
              url: ["pianomp3/jobro/B4.wav"],
              id: "B4",
              autoLoad: true
            });

          }
        }).beginDelayedInit();
		
	    
      </script>
		
	<div class="topBanner" >
	   	 	<div id="message"></div>

	   	 <div id="loginForms">
	       	<form id="loginForm">
	           	<input type="text" id="username" placeholder="Username"><br>
	           	<input type="password" id="password" placeholder="Password"><br>
	           	<button type="submit">Login</button>
	       	</form>
	       	<p>Don't have an account? <a href="#" id="showRegister">Register</a></p>
	  	 </div>

	   <div id="registerForm" style="display: none;">
	       <form>
	           <input type="text" id="regUsername" placeholder="Username"><br>
	           <input type="password" id="regPassword" placeholder="Password"><br>
	           <button type="submit">Register</button>
	       </form>
	       <p>Already have an account? <a href="#" id="showLogin">Login</a></p>
	   </div>

	   <div id="loggedInArea" style="display: none;">
	       <p>Welcome, <span id="loggedInUser"></span>!</p>
	       <button id="logoutButton">Logout</button>
	   </div>
		  
		<div id="score">
			   Score: 
		   </div>
		   
	</div>
	
    <div class="piano_zone">
         <div class="content clearfix">
            <h2>EAR TRAINING - TONIC FINDER</h2>
            
            <div class="btnsWrapper">
              <div class="stop_music hide">Stop Music</div>
              <div class="start_music hide">Start Music</div>
              <div class="start_game">Start Game</div>
              <div class="next_music hide">Next Song</div>
              <div class="repeat_music hide">Repeat Song</div>
            </div>

			<div class="player">
				<!--  Music Player -->
				
				<div class="music-box">
				  <div class="album">
				    <div class="photo"></div>
				    <div class="infos">
				      <div class="song_musicplayer">
						<span>Current Song</span>
						  <small class="hide">Current Artist</small></div>
				    </div>
				  </div>
				  <div class="dashboard">
				    <div class="list">
				      <div class="list-btn disabledd"><span></span></div>
				    </div>
				    <div class="player">
				      <div class="time"><small class="current_musicplayer">0:00</small> / <small class="duration_musicplayer">0:00</small></div>
				      <div class="time-rail">
				        <div class="thumb"></div>
				        <div class="track"></div>
				      </div>
				    </div>
				    <div class="action-button disabledd">
						<a class="random"><i class="fa fa-random"></i></a>
						<a class="prev" onclick="prevSong()"><i class="fa fa-step-backward"></i></a>
						<a class="play-pause active_musicplayer"><i class="fa fa-pause" ></i></a>
						<a class="stop hide"><i class="fa fa-stop"></i></a>
						<a class="next" onclick="randomSong()"><i class="fa fa-step-forward"></i></a>
						<a class="repeat"><i class="fa fa-repeat"></i></a>
						<a class="volume hide"><i class="fa fa-volume-up"></i></a>
						<input type="checkbox" class="hide" id="toggleMarkForEdit">
						<label for="toggleMarkForEdit" class="hide">Toggle Mark For Edit</label>
					</div>
				  </div>
				  <div class="lists">
				    <div class="label">SONGS</div>
				    <div class="box"></div>
				  </div>
				</div>
				
				<!--  end of music player -->
				
				<div id="levelIndicator">
									Current Level: <span class="levelNumber"></span>
							</div>
							
							
							<div class="tags filterZone">
							  <label class="tag tagLabel">Filter Songs :::</label>
							  <button  class="tag langEn">English</button>
							  <button  class="tag langEs">Spanish</button>
							  <button class="tag noteQuality minorF hide">F minor</button>
							  <button class="tag noteQuality majorC hide">C major</button>
							  <button class="tag noteQuality unknownUnknown hide">Unknown</button>
							  <button class="tag noteQuality majorC hide">C major</button>
							  <button class="tag noteQuality minorE hide">E minor</button>
							  <button class="tag noteQuality majorDb hide">Db major</button>
							  <button class="tag noteQuality minorGb hide">Gb minor</button>
							  <button class="tag noteQuality minorA hide">A minor</button>
							  <button class="tag noteQuality minorC hide">C minor</button>
							</div>
							
				
							<div id="userManagement">
							    <h2>User Management</h2>
							    <div id="userList"></div>
							    <button onclick="deleteSelectedUsers()">Delete Selected Users</button>
							    <button onclick="modifySelectedRoles()">Save Role Changes</button>
							</div>
				
				
			</div>
			
            <div class="songsWrapper">

              <div></div>
            </div>

            <div class="keysWrapper disabledd">
              <div data-note="C">C</div>
              <div data-note="Db">Db</div>
              <div data-note="D">D</div>
              <div data-note="Eb">Eb</div>
              <div data-note="E">E</div>
			  <div style="visibility:hidden;"></div>
              <div data-note="F">F</div>
              <div data-note="Gb">Gb</div>
              <div data-note="G">G</div>
              <div data-note="Ab">Ab</div>
              <div data-note="A">A</div>
              <div data-note="Bb">Bb</div>
              <div data-note="B">B</div>
            </div>

			<div class="piano disabledd">
			    <div class="key" data-note="C3"><span>C3</span></div>
			    <div class="black-key" data-note="Db3"><span>Db3</span></div>
			    <div class="key" data-note="D3"><span>D3</span></div>
			    <div class="black-key" data-note="Eb3"><span>Eb3</span></div>
			    <div class="key" data-note="E3"><span>E3</span></div>
			    <div class="key half" data-note="F3"><span>F3</span></div>
			    <div class="black-key" data-note="Gb3"><span>Gb3</span></div>
			    <div class="key" data-note="G3"><span>G3</span></div>
			    <div class="black-key" data-note="Ab3"><span>Ab3</span></div>
			    <div class="key" data-note="A3"><span>A3</span></div>
			    <div class="black-key" data-note="Bb3"><span>Bb3</span></div>
			    <div class="key" data-note="B3"><span>B3</span></div>

			    <div class="key half" data-note="C4"><span>C4</span></div>
			    <div class="black-key" data-note="Db4"><span>Db4</span></div>
			    <div class="key" data-note="D4"><span>D4</span></div>
			    <div class="black-key" data-note="Eb4"><span>Eb4</span></div>
			    <div class="key" data-note="E4"><span>E4</span></div>
			    <div class="key half" data-note="F4"><span>F4</span></div>
			    <div class="black-key" data-note="Gb4"><span>Gb4</span></div>
			    <div class="key" data-note="G4"><span>G4</span></div>
			    <div class="black-key" data-note="Ab4"><span>Ab4</span></div>
			    <div class="key" data-note="A4"><span>A4</span></div>
			    <div class="black-key" data-note="Bb4"><span>Bb4</span></div>
			    <div class="key" data-note="B4"><span>B4</span></div>
			</div>
            
		   
           <div class="settings">
                <div class="announcement">
                  <h3>1. Click Start Game</h3>
                  <h3>2. Use the keyboard to assist you identifying the tonic</h3>
                  <h3>3. Then select the tonic from the letters above the keyboard</h3>
                </div>
                <h4 class="hide">Songs Will Play:</h4>
                <div class="behavior_controls hide">
                  <span>Manual</span>
                  <label class="switch">
                    <input class="switch_check" type="checkbox">
                    <span class="slider round"></span>
                  </label>
                  <span>Auto</span>
                </div>

                <div class="volume_controls disabledd">
                  <label class="songVolText">Song Volume: </label>
                  <input class="songVolInput" type="range" id="volume" value="100">
                  
                  <label class="pianoVolText">Piano Volume: </label>
                  <input class="pianoVolInput" type="range" id="volume2" value="100">
                </div>
				
				<div class="disabledd" style="display:flex;align-items: center;column-gap: 10px;justify-content:space-between;">
					<div style="display: flex;align-items: center;justify-content: space-evenly;column-gap: 10px;">
						<label style="font-weight: bold;">Hide Key Names:</label> 
						<button id="toggleKeyNames" class="toggle-button off">
							<span class="on">YES</span>
							<span class="off">NO</span>
						</button>
					</div>
					<button id="reportBtn">Show Report</button>
				</div>
				
				
           </div>
		   
		   <div class="container">
		     <div class="row">
		       <div class="col">
		         <h1>Graph Report</h1>
		  
		       </div>
		     </div>
		       <div class="row">
		           <div class="col s-12">
		               <p>Keys you get right the most</p>
		               <div class="graph-songs"></div>
		           </div>
			   </div>
			   <div class="row">
		           <div class="col s-12">
		                   <p>Keys you get wrong the most</p>
		               <div class="graph-coffees"></div>
		           </div>
		       </div>
		       
		     </div>


           <script>
			  
			 

			/*
			   // JavaScript to toggle button state
			   document.addEventListener("DOMContentLoaded", function() {
				   
	 			   
				   
			       var toggleButton = document.getElementById("toggleKeyNames");
				   
			       toggleButton.addEventListener("click", function() {
			           toggleButton.classList.toggle("on");
			           toggleButton.classList.toggle("off");
					   $(".piano span").each(function() {
					       $(this).toggleClass("hide");					  
					   });
					   
					   // Call the function with your data object
					   var data1 = {
					       "A": {right: 1, wrong: 1},
					       "Ab": {right: 1, wrong: 1},
					       "B": {right: 1, wrong: 0},
					       "Bb": {right: 1, wrong: 1},
					       "C": {right: 1, wrong: 1},
					       "D": {right: 3, wrong: 1},
					       "Db": {right: 1, wrong: 2},
					       "E": {right: 2, wrong: 1},
					       "Eb": {right: 1, wrong: 1},
					       "F": {right: 2, wrong: 2},
					       "G": {right: 2, wrong: 1},
					       "Gb": {right: 1, wrong: 1}
					   };
					 console.log("YALA");
					//  createGraph(data);

					//  const audioElement = $('audio[data-sound="2"]')[0];

					//  guessGenreOfAudio(audioElement);
					
					function convertData(data) {
					    var right = {};
					    var wrong = {};

					    $.each(data, function(key, value) {
					        right[key] = parseInt(value.right, 10);
					        wrong[key] = parseInt(value.wrong, 10);
					    });

					    var result = {
					        right: {},
					        wrong: {}
					    };

					    for (var key in right) {
					        result.right['"' + key + '"'] = right[key];
					    }

					    for (var key in wrong) {
					        result.wrong['"' + key + '"'] = wrong[key];
					    }

					    return result;
					}

					// Example usage:
					const data = {
					    A: { right: 4, wrong: 1 },
					    B: { right: 3, wrong: 2 },
					    C: { right: 5, wrong: 0 },
					    D: { right: 2, wrong: 3 }
					};

					var result = convertData(data);

					console.log(result.right); // {"A":4,"B":3,"C":5,"D":2}
					console.log(result.wrong); // {"A":1,"B":2,"C":0,"D":3}
					
	 			
			   });
			*/	  
				  // Check if the logged-in user is an admin
				  function isAdminLoggedIn() {
				      // Implement logic to check if the logged-in user is an admin
				      // For example, you can check the user's role stored in session or local storage
				      // Return true if the user is an admin, false otherwise
					  
				  // Retrieve user role from session storage
				      const userId = sessionStorage.getItem('userId');
					  console.log(userId);

				      // Check if the user role is 'admin'
				      return userId === '664a717472d3a827a9665919';
				  }

				  // Function to toggle visibility of user management interface based on admin login status
				  function toggleUserManagementVisibility() {
				      const userManagementDiv = document.getElementById('userManagement');
				      if (isAdminLoggedIn()) {
				          userManagementDiv.style.display = 'block'; // Show the interface for admin
				      } else {
				          userManagementDiv.style.display = 'none'; // Hide the interface for non-admin users
				      }
				  }

				  
				  
				  // Function to fetch users from the server
				  async function fetchUsers() {
				      try {
				          const response = await fetch('/users');
				          const users = await response.json();
				          displayUsers(users);
				      } catch (error) {
				          console.error('Error fetching users:', error.message);
				      }
				  }
				
				
				  // Function to display users in the interface
				  function displayUsers(users) {
				      const userListElement = document.getElementById('userList');
				      userListElement.innerHTML = ''; // Clear existing user list

				      users.forEach(user => {
				          const userDiv = document.createElement('div');
				          userDiv.classList.add('user');

				          // Create a checkbox for user selection
				          const checkbox = document.createElement('input');
				          checkbox.type = 'checkbox';
				          checkbox.value = user._id; // Assuming user ID is stored in the _id field
				          userDiv.appendChild(checkbox);

				          // Create a dropdown menu for selecting user roles
				          const roleSelect = document.createElement('select');
				          roleSelect.classList.add('role-select');
				          const adminOption = document.createElement('option');
				          adminOption.value = 'admin';
				          adminOption.textContent = 'Admin';
				          const regularOption = document.createElement('option');
				          regularOption.value = 'regular';
				          regularOption.textContent = 'Regular';
				          roleSelect.appendChild(adminOption);
				          roleSelect.appendChild(regularOption);
				          roleSelect.value = user.role; // Set the default role based on user's current role
				          userDiv.appendChild(roleSelect);

				          // Display username
				          const usernameSpan = document.createElement('span');
				          usernameSpan.textContent = user.username;
				          userDiv.appendChild(usernameSpan);

				          userListElement.appendChild(userDiv);
				      });
				  }

				  // Function to delete selected users
				  async function deleteSelectedUsers() {
				      const checkboxes = document.querySelectorAll('.user input[type="checkbox"]:checked');
				      const userIds = Array.from(checkboxes).map(checkbox => checkbox.value);

				      try {
				          const responses = await Promise.all(userIds.map(userId => fetch(`/users/${userId}`, { method: 'DELETE' })));
				          const success = responses.every(response => response.ok);
				          if (success) {
				              // Refresh user list after deletion
				              fetchUsers();
				          } else {
				              throw new Error('Failed to delete some users');
				          }
				      } catch (error) {
				          console.error('Error deleting users:', error.message);
				      }
				  }

				  // Function to modify roles of selected users
				  async function modifySelectedRoles() {
				      const checkboxes = document.querySelectorAll('.user input[type="checkbox"]:checked');
				      const updates = Array.from(checkboxes).map(checkbox => {
				          const userId = checkbox.value;
				          const userDiv = checkbox.parentElement;
				          const roleSelect = userDiv.querySelector('.role-select'); // Select the role dropdown within the user div
				          const role = roleSelect.value; // Get the selected role from the dropdown
				          return { userId, role };
				      });

				      try {
				          const responses = await Promise.all(updates.map(({ userId, role }) => fetch(`/users/${userId}`, { method: 'PATCH', body: JSON.stringify({ role }), headers: { 'Content-Type': 'application/json' } })));
				          const success = responses.every(response => response.ok);
				          if (success) {
				              // Refresh user list after role modification
				              fetchUsers();
				          } else {
				              throw new Error('Failed to modify roles for some users');
				          }
				      } catch (error) {
				          console.error('Error modifying roles:', error.message);
				      }
				  }
				  
				  function toggleMarkForEdit() {
				      // Select all elements with class "song" and "playing"
				      const songsPlaying = document.querySelectorAll('.song.playing');
    
				      // Loop through each element
				      songsPlaying.forEach(song => {
				          // Get the parent <li> element
				          const parentLi = song.closest('li');
        
				          // Toggle class "markForEdit" on the parent <li>
				          parentLi.classList.toggle('markForEdit');
				      });
				  }
				
				  document.getElementById('toggleMarkForEdit').addEventListener('change', function() {
				          toggleMarkForEdit();
				  }); 

				  
                 let globalVol = 0.1;
                 let globalNoteVol = 50;
                 let globalPlayingStyle = 0;
                 let globalSongsPlayed = [];
				 let globalFirstTry = null;
				 let userLoggedIn = false;
				 let userId = '';
				 let globalLevel = 1;
				 let globalKeyStats = [{}];
				 
				 const keys = document.querySelectorAll('.key, .black-key');
                 const songs = document.querySelectorAll('.song');
				 
                 const songKeys = document.querySelectorAll('.keysWrapper > div');
                 const stopBtn = document.querySelector('.stop_music');
                 const btn2 = document.querySelector('.start_game');
                 const btn3 = document.querySelector('.next_music');
                 const repeatBtn = document.querySelector('.repeat_music');
                 const startMusicBtn = document.querySelector('.start_music');
				 
				 document.getElementById("loginForm").addEventListener("submit", async function(event) {
				             event.preventDefault();
				             const username = document.getElementById("username").value;
				             const password = document.getElementById("password").value;

				             const response = await fetch('/login', {
				                 method: 'POST',
				                 headers: {
				                     'Content-Type': 'application/json'
				                 },
				                 body: JSON.stringify({ username, password })
				             });

						
							 const message = await response.text();
							 const parsedMessage = JSON.parse(message); // Parse the JSON string into an object
							 const messageElement = document.getElementById("message");
							 messageElement.innerText = parsedMessage.message;
							 userId = parsedMessage.userId;
							 console.log(userId);
							 
							 
							 // Hide the message after 3 seconds
							 setTimeout(() => {
							     messageElement.innerText = ""; // Clear the message
							 }, 3000); // 3000 milliseconds = 3 seconds
							 // 
							 
							 if (parsedMessage.message === "Login successful.") {
							     document.getElementById("loggedInUser").innerText = username;
							     document.getElementById("loginForms").style.display = "none";
							     const loggedInArea = document.getElementById("loggedInArea");
								 $(loggedInArea).css("display","block");
								 $(loggedInArea).children("p").css("display", "inline-block");
								  userLoggedIn = true;
								  console.log(userId);
								  getKeyStatsReportForUser(userId); 
							 }
				         });

				         document.getElementById("registerForm").addEventListener("submit", async function(event) {
				             event.preventDefault();
				             const username = document.getElementById("regUsername").value;
				             const password = document.getElementById("regPassword").value;

				             const response = await fetch('/register', {
				                 method: 'POST',
				                 headers: {
				                     'Content-Type': 'application/json'
				                 },
				                 body: JSON.stringify({ username, password })
				             });

				             const message = await response.text();
				             document.getElementById("message").innerText = message;
					         document.getElementById('registerForm').style.display = 'none';
					         
							 const messageElement = document.getElementById("message");
							 messageElement.innerText = message
							 // Hide the message after 3 seconds
							 setTimeout(() => {
							     messageElement.innerText = ""; // Clear the message
								 document.getElementById('loginForms').style.display = 'flex';
							 }, 3000); // 3000 milliseconds = 3 seconds
							 // 
				         });
						 
						 document.getElementById('showRegister').addEventListener('click', function(e) {
						         e.preventDefault();
						         document.getElementById('loginForms').style.display = 'none';
						         document.getElementById('registerForm').style.display = 'flex';
						     });

						     document.getElementById('showLogin').addEventListener('click', function(e) {
						         e.preventDefault();
						         document.getElementById('registerForm').style.display = 'none';
						         document.getElementById('loginForms').style.display = 'flex';
						     });

				         document.getElementById("logoutButton").addEventListener("click", async function() {
				             const response = await fetch('/logout', {
				                 method: 'POST'
				             });
				             const message = await response.text();
							 
				             if (message === "Logged out successfully.") {
				                 
				                 document.getElementById("loggedInArea").style.display = "none";
								 const messageElement = document.getElementById("message");
								 messageElement.innerText = message;
								//clearGraphs(); $(".container").empty();
								clearGraphs();
								 
								 // Hide the message after 3 seconds
								 setTimeout(() => {
								     messageElement.innerText = ""; // Clear the message
									 document.getElementById("loginForms").style.display = "flex";
								 }, 3000); // 3000 milliseconds = 3 seconds
								 // 
							 
								 if ($(".playing").length > 0) {
								 	stopGame();
								 }
							 }
				         });
					  

						 function populateSongs() {
		 					$.getJSON('songList.json', function(data) {
		 					        var htmlContent = '';
		 					        data.forEach(function(item) {
		 					            htmlContent += '<li>';
		 					            htmlContent += '<div class="song" data-song="' + item['data-song'] + '" data-note="' + item['data-note'] + '" data-quality="' + item['data-quality'] + '"data-lang="' + item['lang'] + '">' + item['song'] + '  <i class="fa fa-solid fa-volume-up hide"></i>' + '</div>';
		 					            htmlContent += '<audio data-sound="' + item['data-song'] + '" src="' + item['audio_src'] + '"></audio>';
		 					            htmlContent += '</li>';
		 					        });
		 					        $('.lists').append('<ul>' + htmlContent + '</ul>');
									
				                    const songs = document.querySelectorAll('.song');
				                    const songKeys = document.querySelectorAll('.keysWrapper > div');
									
				                    songs.forEach(song => {
				                       song.addEventListener('mousedown', () => {
				                         const note = song.dataset.song;
				                         playSong(note);
				   					  $(".list-btn").click();
				                       });
				                    });
									
									

				   				 songKeys.forEach(key => {
				   				     key.addEventListener('mousedown', () => {
				   				         const currentSong = document.querySelector('div.activa');
				   				         const songPlaying = document.querySelector('div.playing');
				   				         const note = key.dataset.note;

				   				         if (currentSong != null) {
				   				             $(".announcement").hide();
				   				             $(".settings").addClass("noBanner");
				   				             const currentKey = currentSong.dataset.note;
				   				             const song = currentSong.dataset.song;
				   				             console.log(note);
				   				             console.log(currentKey);

				   				             if (note == currentKey) {
				   				                 key.classList.add('right');
				   				                 songKeys.forEach(key1 => {
				   				                     if (key != key1) { key1.classList.remove('wrong'); }
				   				                 });
				   				                 if (songPlaying != null) {
				   				                     stopSong(song);
				   				                 }

				      							  	 // Increment wrong count for the currentKey
				   				                 keyStats[currentKey] = keyStats[currentKey] || { right: 0, wrong: 0 };
				   				                 keyStats[currentKey].wrong++;

				   				                 console.log("user ID: ", userId);
				   				                 console.log("keyStats: ", keyStats);
								 
				   				                 // Send key statistics data to server
				   				                 if (userLoggedIn) {
				   				                     sendKeyStatsToServer(userId, keyStats);
				   				                 }

				   				                 // If it's the first try and user is logged in, increment score
				   				                 if (globalFirstTry && userLoggedIn) {
				   				                     console.log("true: ", globalFirstTry);
				   				                     game.incrementScore();
				   				                 }

				   				                 setTimeout(function () {
				   				                     key.classList.remove('right');
				   				                     randomSong();
				   				                 }, 600);
				   				             } else {
				   				                 key.classList.add('wrong');

				   				                 // Increment wrong count for this key
				   				                 keyStats[note] = (keyStats[note] || {});
				   				                 keyStats[note].wrong = (keyStats[note].wrong || 0) + 1;

				   				                 // Send key statistics data to server
				   				                 if (userLoggedIn) {
				   				                    sendKeyStatsToServer(userId, keyStats);
				   				                 }

				   				                 globalFirstTry = false;
				   				                 console.log(globalFirstTry);
				   				             }
				   				         }

				   				 });

				                    key.addEventListener('touchstart', () => {
				                       /* use if you need something to be only on TOUCH. if nothing here TOUCH uses MOUSEDOWN above*/
				                       preventDefault();
				                       stopPropagation();
				                    });
				                   });
									
									
		 					    });
						 }
						 
						 const buttons = document.querySelectorAll('.tag');

						 buttons.forEach(button => {
						   button.addEventListener('click', () => {
						     const isActive = button.classList.toggle('active');
						     const buttonText = button.textContent;
						     console.log(`Button state: ${buttonText} is ${isActive ? 'On' : 'Off'}`);
							 
						//	 const buttonText = button.textContent;
							 const divsWithMatchingLang = $('div.song[data-lang="' + buttonText + '"]');
							 if (isActive) {
							 	console.log(divsWithMatchingLang);
								divsWithMatchingLang.addClass("filteredIn");
								divsWithMatchingLang.removeClass("filteredOut");
							 } else {
 								divsWithMatchingLang.removeClass("filteredIn");
 								divsWithMatchingLang.addClass("filteredOut");
							 }
							 
						   });
						 });
						 
                 $("document").ready(function() {
					//  sessionStorage.setItem('userId', '0');
					populateSongs();  
					
                    let globalVol = 0.1;
                    let globalNoteVol = 50;
                    let globalPlayingStyle = 0;
                    let globalSongsPlayed = [];
   				 let globalFirstTry = null;
   				 let userLoggedIn = false;
   				 let userId = '';
   				 let globalLevel = 1;
				 
   				 const keys = document.querySelectorAll('.key, .black-key');
                    
                    const stopBtn = document.querySelector('.stop_music');
                    const btn2 = document.querySelector('.start_game');
                    const btn3 = document.querySelector('.next_music');
                    const repeatBtn = document.querySelector('.repeat_music');
                    const startMusicBtn = document.querySelector('.start_music');
						
                    console.log(globalVol);
                    volume.value = globalVol;
					//globalNoteVal = 50;
					$("#volume2").val(50);
				   // soundManager.setVolume(90);

					
			 		/* MUSIC PLAYER JS */

			 		  $(".list-btn").click(function() {
			 		    $(this).parent().toggleClass("active_musicplayer");
			 		    return $(".lists").toggleClass("active_musicplayer");
			 		  });

			 		  $(".action-button").find('a').click(function() {
			 		    if ($(this).hasClass("random") || $(this).hasClass("play-pause") || $(this).hasClass("repeat")) {
			 		  //    return $(this).toggleClass("active_musicplayer");
			 		    }
			 		  });
					  
				      // Fetch users when the page loads
				      fetchUsers();
					
                 });
				 
		 		/* End of MUSIC PLAYER JS */
				 

                 volume.addEventListener("input", (e) => {
                    const currentSong = document.querySelector('div.activa');
                    let audio = document.querySelector(`audio[data-sound="${currentSong.dataset.song}"]`);
                     // console.log(e.currentTarget.value);
                    audio.volume = e.currentTarget.value / 100;
                    globalVol = audio.volume;   
                });

                volume.addEventListener("touchmove", (e) => {
                  console.log(e.currentTarget.value);
                  const currentSong = document.querySelector('div.activa');
                    let audio = document.querySelector(`audio[data-sound="${currentSong.dataset.song}"]`);
                     // console.log(e.currentTarget.value);
                    audio.volume = e.currentTarget.value / 100;
                    globalVol = audio.volume;   
                });


                volume2.addEventListener("input", (e) => {
                    globalNoteVol = e.currentTarget.value;
                });
				
				$(`div.action-button > .play-pause`).on('click', () => {
					if ($(`div.action-button > .play-pause`).hasClass("active_musicplayer")) {
						$('.play-pause').toggleClass('active_musicplayer');
						startMusicBtn.click();
					} else {
						$('.play-pause').toggleClass('active_musicplayer');
						//console.log('TESt: ', $(".playing"));
						
	                    //const currentSong = document.querySelector('div.playing');
	                    stopBtn.click();;
					}
				});

                stopBtn.addEventListener('click', () => {
                  const currentSong = document.querySelector('div.playing');
                  stopSong(currentSong.dataset.song);
                  startMusicBtn.classList.remove("hide");
                  stopBtn.classList.add("hide");
                });

                repeatBtn.addEventListener('click', ()=> {
                  const currentSong = document.querySelector('div.activa');
                  playSong(currentSong.dataset.song);

                });

                startMusicBtn.addEventListener('click', ()=> {
                  const currentSong = document.querySelector('div.activa');
                  playSong(currentSong.dataset.song);
                  startMusicBtn.classList.add("hide");
                  stopBtn.classList.remove("hide");
                });
				
				// Function to send key statistics to server
				function sendKeyStatsToServer(userId, keyStats) {
								    fetch(`/updateKeyStats/${userId}`, {
								        method: 'POST',
								        headers: {
								            'Content-Type': 'application/json'
								        },
								        body: JSON.stringify(keyStats)
								    })
								    .then(response => {
								        if (!response.ok) {
								            throw new Error('Failed to update key stats');
								        }
								    })
								    .catch(error => {
								        console.error('Error updating key stats:', error);
								    });
			     }
									
				// Function to fetch key stats report for a specific user from server
				function getKeyStatsReportForUser(userId) {
				    fetch(`/getKeyStatsReport/${userId}`)
				    .then(response => {
				        if (!response.ok) {
				            throw new Error('Failed to fetch key stats report');
				        }
				        return response.json();
				    })
				    .then(report => {
				        // Process the key stats report
				        console.log('Key stats report for user:', report);
						generateGraph(report);
						globalKeyStats = report;
						
				    })
				    .catch(error => {
				        console.error('Error fetching key stats report:', error);
				    });
				}
				
				function guessGenreOfAudio(audioElement) {
					console.log(audioElement);
	            
				    // Send the audio element to the server
				    fetch('http://localhost:3000/guess-genre', {
				        method: 'POST',
				        headers: {
				            'Content-Type': 'application/json'
				        },
				        body: JSON.stringify({ audioElement: audioElement })
				    })
				    .then(response => {
				        if (!response.ok) {
				            throw new Error(`Failed to fetch: ${response.statusText}`);
				        }
				        return response.json();
				    })
				    .then(data => {
				        // Process the response, which should contain the predicted genre
				        console.log('Predicted genre:', data.genre);
				    })
				    .catch(error => {
				        // Handle errors
				        console.error('Error:', error);
				    });
				}

                function randomSong() {
                  if(globalSongsPlayed.length < $(".song").length) {
                     // console.log("CHECKED");
                     btn2.style.display = 'none';
                     btn3.style.display = 'block';
                      // var randSong = Math. floor(Math. random()*$(".song").length) + 1;
					  
					  // Initialize an empty array to store the numbers
					  let numbersArray = [];

					  // Iterate over each div element with the class "song"
					  if ($('.lists .filteredIn').length === 0) {
					      $('.lists .song').each(function() {
					          // Your code here
						      // Get the value of the "data-song" attribute and convert it to a number
						      const number = parseInt($(this).attr('data-song'));
    
						      // Push the number to the array if it's a valid number
						      if (!isNaN(number)) {
						          numbersArray.push(number);
						      }
					      });
					  } else {
					      $('.lists .filteredIn').each(function() {
					          // Your code here
						      // Get the value of the "data-song" attribute and convert it to a number
						      const number = parseInt($(this).attr('data-song'));
    
						      // Push the number to the array if it's a valid number
						      if (!isNaN(number)) {
						          numbersArray.push(number);
						      }
					      });
					  }
					
					  // Generate a random index within the range of the array length
					  const randomIndex = Math.floor(Math.random() * numbersArray.length);

					  // Get the random number from the array using the random index
					  var randSong = numbersArray[randomIndex];
					  
                      if(globalSongsPlayed.includes(randSong)) {
                        console.log("LENGTH: "+globalSongsPlayed.length);
                        randomSong();
                      } else {
                        playSong(randSong);
                        globalSongsPlayed.push(randSong);
                        console.log("VALIDO");
                        console.log(randSong);

                      }
                    } else {
                      //console.log("NOT CHECKED");
                      globalSongsPlayed.length = 0;
                      console.log("STYLE: "+globalPlayingStyle);
                      btn2.style.display = 'block';
                      btn3.style.display = 'none';
                      //randomSong();
                    }
                }
				let game; // Declaring game variable in the outer scope

                btn2.addEventListener('click', () => {
                  console.log("START GAME NOW");
                  $(".disabledd").removeClass('disabledd');
				     $('.levelNumber').text(globalLevel);
                  randomSong();
				  $('.playing').addClass('lastPlayed');
				  	$('#score').html('Score: ' + 0);
				  
		    	  // these functions are used to respond when score/level changes
		       		const scoreSubscriber = function(newScore) {
		       			$('#score').html('Score: ' + newScore);
		     		  }
			   
		    	   const levelSubscriber = function(newLevel) {
		      		 alert('You reached level ' + newLevel);
		     	  }

		      	 // initialise game
		     	  game = createGame(scoreSubscriber, levelSubscriber);
				  console.log(game);
			   
                });

                btn3.addEventListener('click', () => {
                 // console.log("START GAME NOW");
                  ///btn2.hide();
                  randomSong();
                  startMusicBtn.classList.add("hide");
                });

                 function playSongAuto() {
                  console.log("PLAYING AUTOMATICALLY");
                 }

                 function playSound(note) {
                  const audio = document.querySelector(`audio[data-sound="${note}"]`);
                     if (!audio) return;
                     audio.currentTime = 0.0;
                    // if (note = 'D') {audio.currentTime = 0.8;}
                     audio.volume = globalNoteVol;
                     audio.play();
                 }

                 function stopSound(note) {}
				 
				 function prevSong() {
					 console.log("PREV SONG");
					 const prevSong = document.querySelector('div.lastPlayed');
					 playSong(prevSong.dataset.song);
				 }
					
                 function playSong(note) {
                     if (currPlaying = document.querySelector('div.playing')) {
                        stopSong(currPlaying.dataset.song);
                     };
                     
                     const audio = document.querySelector(`audio[data-sound="${note}"]`);
                     if (!audio) return;
                     audio.currentTime = 0;
					 
                     audio.volume = globalVol;
                     audio.play();
					 audio.ontimeupdate = function () {
						 $(".current_musicplayer").text(sToTime(audio.currentTime).slice(3))
						 
		   			         var railWidth = (audio.currentTime / audio.duration) * 100; // Calculate the percentage width
		   					// console.log(audio.currentTime);
		   			         // Update the width of the thumb element
						     var position = (audio.currentTime / audio.duration) * railWidth; // Calculate the position

						           // Update the left position of the thumb element
						     $(".thumb").css("left", position + "px");
				 
					 }
					 
					 $('.duration_musicplayer').text(sToTime(audio.duration).slice(3));
                     const songPlaying = document.querySelector(`div[data-song="${note}"]`);
                     const songs = document.querySelectorAll('div.song');
                     const repeatBtn = document.querySelector('div.repeat_music');
                     const stopBtn = document.querySelector('div.stop_music');
                     const songDisplaying = document.querySelector('div.song_musicplayer > span');
					 const artistDisplaying = document.querySelector('div.song_musicplayer > small');
					 const playBtn = document.querySelector('a.play-pause');
					 let availKeys = $('.keysWrapper div[data-note]').filter(function() {
										     return $(this).data('note').length <= 2;
										 });
					 globalFirstTry = true;
					 
                     songs.forEach(song => {
                        song.classList.remove('activa');
                     });

					 songPlaying.classList.remove('hide');
					 songDisplaying.innerText = songPlaying.innerText;
					 $('.song_musicplayer').find('br').remove();
					 //console.log(songDisplaying.innerText);
					 playBtn.classList.remove('active_musicplayer');
					 
                     songPlaying.classList.add('playing');
                     songPlaying.classList.add('activa');
                     btn2.classList.add('hide');
                     btn3.classList.remove('hide');
                     repeatBtn.classList.remove('hide');
                     stopBtn.classList.remove('hide');
					 
					 
					 const currentKey = songPlaying.dataset.note;
				
										 console.log("availKeys: ", availKeys);
					 
						 				 const $keyWithNote  = availKeys.filter(function() {
											 console.log("the note: ",this.dataset.note);
											 console.log("the currentKey: ",currentKey);
						 
					    				 	return this.dataset.note === currentKey;
										 });
					 
										 console.log($keyWithNote);
					
										 availKeys = availKeys.not($keyWithNote);

										 console.log(availKeys);
					 
										 // Generate a random index within the length of availKeys array
										 const randomIndex = Math.floor(Math.random() * availKeys.length);

										 // Select the random div
										 const randomDiv = availKeys.eq(randomIndex);

										 // Assign $otherKey to the random div
										 const $otherKey = randomDiv;

										 // Remove the random div from availKeys
										 availKeys = availKeys.not(randomDiv);
					 
										 console.log(availKeys);
					 
										 // Select the random div
										 const randomDiv2 = availKeys.eq(randomIndex);

										 // Assign $otherKey to the random div
										 const $thirdKey = randomDiv2;

										 // Remove the random div from availKeys
										 availKeys = availKeys.not(randomDiv2);
					 
					
										 // Select the random div
										 const randomDiv3 = availKeys.eq(randomIndex);

										 // Assign $otherKey to the random div
										 const $fourthKey = randomDiv3;

										 // Remove the random div from availKeys
										 availKeys = availKeys.not(randomDiv3);
					 
					

										 // Select the random div
										 const randomDiv4 = availKeys.eq(randomIndex);

										 // Assign $otherKey to the random div
										 const $fifthKey = randomDiv4;

										 // Remove the random div from availKeys
										 availKeys = availKeys.not(randomDiv4);
					 
					

										 // Select the random div
										 const randomDiv5 = availKeys.eq(randomIndex);

										 // Assign $otherKey to the random div
										 const $sixthKey = randomDiv5;

										 // Remove the random div from availKeys
										 availKeys = availKeys.not(randomDiv5);
					 
				    
										// console.log($sixthKey);
					   
										 $('.keysWrapper div').addClass('disabledd');
						                 console.log(songPlaying);
	 		 
								         switch (globalLevel) {
											 case 1:
												 // Conditions for level 1
												 console.log("Reached level 1!");
												 console.log(currentKey);
												 console.log($keyWithNote);
											     $keyWithNote.removeClass('disabledd');
												 $otherKey.removeClass('disabledd');
												 break;
								             case 2:
								                 // Conditions for level 2
								                 console.log("Reached level 2!");
												 console.log(currentKey);
												 $('.keysWrapper div').addClass('disabledd');
												 $keyWithNote.removeClass('disabledd');
												 $otherKey.removeClass('disabledd');
												 $thirdKey.removeClass('disabledd');
							 
								                 break;
								             case 3:
								                 // Conditions for level 3
								                 console.log("Reached level 3!");
												 console.log(currentKey);
												 $('.keysWrapper div').addClass('disabledd');
												 $keyWithNote.removeClass('disabledd');
												 $otherKey.removeClass('disabledd');
												 $thirdKey.removeClass('disabledd');
												 $fourthKey.removeClass('disabledd');
												 console.log($fourthKey);
			                 
												 break;
								             case 4:
								                 // Conditions for level 4
								                 console.log("Reached level 4!");
												 console.log(currentKey);
												 $('.keysWrapper div').addClass('disabledd');
												 $keyWithNote.removeClass('disabledd');
												 $otherKey.removeClass('disabledd');
												 $thirdKey.removeClass('disabledd');
												 $fourthKey.removeClass('disabledd');
												 $fifthKey.removeClass('disabledd');
												 console.log($fifthKey);
			                 
												 break;  
											 case 5:
								                 // Conditions for level 5
								                 console.log("Reached level 5!");
												 console.log(currentKey);
												 $('.keysWrapper div').addClass('disabledd');
												 $keyWithNote.removeClass('disabledd');
												 $otherKey.removeClass('disabledd');
												 $thirdKey.removeClass('disabledd');
												 $fourthKey.removeClass('disabledd');
												 $fifthKey.removeClass('disabledd');
												 $sixthKey.removeClass('disabledd');
												 console.log($fifthKey);
								                 console.log($sixthKey);
												 console.log($fourthKey);
							 
												 break;
											 case 6:
										     case 7:
											 case 8:
											 case 9:
								                 // Conditions for level 5
								                 console.log("Reached level Advanced!");
												  $('.keysWrapper div').removeClass('disabledd');
							  
												  break;
								             // Add more cases for additional levels
								             default:
								                 // Default case
								                 console.log("Default level reached!");
								         }
					 
                     setTimeout(function (){
                        audio.pause();
                        songPlaying.classList.remove('playing');
                      }, 90000);
                 }
				 
				 function sToTime(t) {
				   return padZero(parseInt((t / (60 * 60)) % 24)) + ":" +
				          padZero(parseInt((t / (60)) % 60)) + ":" + 
				          padZero(parseInt((t) % 60));
				 }
				 function padZero(v) {
				   return (v < 10) ? "0" + v : v;
				 }

                 function stopSong(note) {
                    const audio = document.querySelector(`audio[data-sound="${note}"]`);
                    audio.pause();
                    const songPlaying = document.querySelector('div.playing');
                    songPlaying.classList.remove('playing');
					const songLastPlayed = '';
					if (songLastplayed = document.querySelector('div.lastPlayed')) {
						songLastplayed.classList.remove('lastPlayed');
					}
                    songPlaying.classList.add('lastPlayed');
				 	const playBtn = document.querySelector('a.play-pause');
				 	playBtn.classList.add('active_musicplayer');
					
                 }
				 
				 function stopGame() {
					 console.log("STOPPING GAME");
					 stopBtn.click();
				 }
				 
				 function createGame(onScoreChanged, onLevelChanged) {
				     let score = 0;
				     const scoreIncrement = 10;
				     let level = 1;

					 const incrementScore = () => {
									     score += scoreIncrement;
									     onScoreChanged(score);
									     if (score >= (level * 100)) {
									         onLevelChanged(++level);
									         globalLevel = level; // Update globalLevel to match the current level
											 $('.levelNumber').text(level);
									        // console.log(`Reached level ${level}!`);
									     }
									 }
    
				     return {
				         incrementScore
				     }
				 }
                
				 
				
				 // Initialize counters in local storage if they don't exist
				 keyStats = JSON.parse(localStorage.getItem('keyStats')) || {};


                 keys.forEach(key => {
                    
                     key.addEventListener('mousedown', () => {
                      const currentSong = document.querySelector('div.playing');
                         const note = key.dataset.note;
                         soundManager.stopAll();
						 soundManager.setVolume(globalNoteVol);
                         soundManager.play(note);
							
                          //playSound(note);
                         key.classList.add('active');
                     });

                     key.addEventListener('mouseup', () => {
                         key.classList.remove('active');
                       //  stopSound(key.dataset.note);
                     });

                     key.addEventListener('mouseleave', () => {
                         key.classList.remove('active');
                        // stopSound(key.dataset.note);
                     });

                     key.addEventListener('touchstart', (event) => {
                      const currentSong = document.querySelector('div.playing');
                         const note = key.dataset.note;
                         soundManager.stopAll();
                         soundManager.play(note);
                          //playSound(note);
                          event.preventDefault();
                         key.classList.add('active');
                     });

                     key.addEventListener('touchend', () => {
                         key.classList.remove('active');
                         //stopSound(key.dataset.note);
                     });
                 });

                

                const checkBox = document.querySelector("input.switch_check");
                checkBox.addEventListener('click', ()=> {
                    if(checkBox.checked) {
                      globalPlayingStyle = 1;
                    } else {
                      globalPlayingStyle = 0
                    }
                    console.log(globalPlayingStyle);
                });


             </script>

         </div>
		
     </div>
	 <script src='/dist/graphiq.js'></script>
	   <script  src="/dist/script.js"></script>
  </body>
</html>
