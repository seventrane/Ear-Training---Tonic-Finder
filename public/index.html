<html>
<head>
    <title>Ear training App</title>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <link rel="stylesheet" href="stylesheets/style.css" />
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.0.0/mdb.min.css" />

    <style>
       /*local style*/

       /* SLIDER SWITCH STYLES */

       .switch {
          position: relative;
          display: inline-block;
          width: 60px;
          height: 34px;
        }

        .switch input { 
          opacity: 0;
          width: 0;
          height: 0;
        }

        .slider {
          position: absolute;
          cursor: pointer;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: #ccc;
          -webkit-transition: .4s;
          transition: .4s;
        }

        .slider:before {
          position: absolute;
          content: "";
          height: 26px;
          width: 26px;
          left: 4px;
          bottom: 4px;
          background-color: white;
          -webkit-transition: .4s;
          transition: .4s;
        }

        input:checked + .slider {
          background-color: #2196F3;
        }

        input:focus + .slider {
          box-shadow: 0 0 1px #2196F3;
        }

        input:checked + .slider:before {
          -webkit-transform: translateX(26px);
          -ms-transform: translateX(26px);
          transform: translateX(26px);
        }

        /* Rounded sliders */
        .slider.round {
          border-radius: 34px;
        }

        .slider.round:before {
          border-radius: 50%;
        }


    </style>
</head>

  <body>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/3.0.0/mdb.min.js" ></script>
    <script type="text/javascript" src="js/client.js" ></script>

     <div class="piano_zone">
         <div class="content">
            <h2>EAR TRAINING - TONIC FINDER</h2>
            
            <div class="stop_music">Stop Music</div>
            <div class="start_music">Start Game</div>
            <div class="next_music hide">Nextt Song</div>

            <div class="songsWrapper" style="width:49%;">
              <div class="song" data-song="1" data-note="A#">
                Bohemian Rhapsody
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="1" src="pianoSongs/bohemianRhapsody.mp3"></audio>

              <div class="song" data-song="2" data-note="G">
                Gravity John Mayer
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="2" src="pianoSongs/gravityJohnmayer.mp3"></audio>

              <div class="song" data-song="3" data-note="A#">
                Purple Rain Prince
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="3" src="pianoSongs/purpleRainPrince.mp3"></audio>

              <div class="song" data-song="4" data-note="A">
                September EWF
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="4" src="pianoSongs/septemberEWF.mp3"></audio>

              <div class="song" data-song="5" data-note="A">
                Stairway to Heaven Led Zeppelin
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="5" src="pianoSongs/stairwayToHeavenLed.mp3"></audio>

              <div class="song" data-song="6" data-note="F#">
                Billie Jean Michael Jackson
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="6" src="pianoSongs/billieJeanMJ.mp3"></audio>

              <div class="song" data-song="7" data-note="F#">
                Wonderwall Oasis
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="7" src="pianoSongs/wonderwallOasis.mp3"></audio>

              <div class="song" data-song="8" data-note="F">
                Happy Pharrell Williams
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="8" src="pianoSongs/happyPharell.mp3"></audio>

              <div class="song" data-song="9" data-note="A">
                Someone Like You Adele
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="9" src="pianoSongs/someoneLikeYouAdele.mp3"></audio>

              <div class="song" data-song="10" data-note="B">
                Hotel California The Eagles
                <i class="fa fa-solid fa-volume-up hide"></i>
              </div>
              <audio data-sound="10" src="pianoSongs/hotelCaliforniaEagles.mp3"></audio>
              <div></div>
            </div>

            <div class="keysWrapper">
              <div data-note="C">C</div>
              <div data-note="C#">C#/Db</div>
              <div data-note="D">D</div>
              <div data-note="D#">D#/Eb</div>
              <div data-note="E">E</div>
              <div data-note="F">F</div>
              <div data-note="F#">F#/Gb</div>
              <div data-note="G">G</div>
              <div data-note="G#">G#/Ab</div>
              <div data-note="A">A</div>
              <div data-note="A#">A#/Bb</div>
              <div data-note="B">B</div>
            </div>

            <div class="piano">
                <div class="key" data-note="C3"></div>
                <div class="black-key" data-note="C#3"></div>
                <div class="key" data-note="D3"></div>
                <div class="black-key" data-note="D#3"></div>
                <div class="key" data-note="E3"></div>
                <div class="key" data-note="F3"></div>
                <div class="black-key" data-note="F#3"></div>
                <div class="key" data-note="G3"></div>
                <div class="black-key" data-note="G#3"></div>
                <div class="key" data-note="A3"></div>
                <div class="black-key" data-note="A#3"></div>
                <div class="key" data-note="B3"></div>

                <audio data-sound="C3" src="pianomp3/C3.mp3"></audio>
                <audio data-sound="C#3" src="pianomp3/Db3.mp3"></audio>
                <audio data-sound="D3" src="pianomp3/D3.mp3"></audio>
                <audio data-sound="D#3" src="pianomp3/Eb3.mp3"></audio>
                <audio data-sound="E3" src="pianomp3/E3.mp3"></audio>
                <audio data-sound="F3" src="pianomp3/F3.mp3"></audio>
                <audio data-sound="F#3" src="pianomp3/Gb3.mp3"></audio>
                <audio data-sound="G3" src="pianomp3/G3.mp3"></audio>
                <audio data-sound="G#3" src="pianomp3/Ab3.mp3"></audio>
                <audio data-sound="A3" src="pianomp3/A3.mp3"></audio>
                <audio data-sound="A#3" src="pianomp3/Bb3.mp3"></audio>
                <audio data-sound="B3" src="pianomp3/B3.mp3"></audio>

                <div class="key" data-note="C4"></div>
                <div class="black-key" data-note="C#4"></div>
                <div class="key" data-note="D4"></div>
                <div class="black-key" data-note="D#4"></div>
                <div class="key" data-note="E4"></div>
                <div class="key" data-note="F4"></div>
                <div class="black-key" data-note="F#4"></div>
                <div class="key" data-note="G4"></div>
                <div class="black-key" data-note="G#4"></div>
                <div class="key" data-note="A4"></div>
                <div class="black-key" data-note="A#4"></div>
                <div class="key" data-note="B4"></div>

                <audio data-sound="C4" src="pianomp3/C4.mp3"></audio>
                <audio data-sound="C#4" src="pianomp3/Db4.mp3"></audio>
                <audio data-sound="D4" src="pianomp3/D4.mp3"></audio>
                <audio data-sound="D#4" src="pianomp3/Eb4.mp3"></audio>
                <audio data-sound="E4" src="pianomp3/E4.mp3"></audio>
                <audio data-sound="F4" src="pianomp3/F4.mp3"></audio>
                <audio data-sound="F#4" src="pianomp3/Gb4.mp3"></audio>
                <audio data-sound="G4" src="pianomp3/G4.mp3"></audio>
                <audio data-sound="G#4" src="pianomp3/Ab4.mp3"></audio>
                <audio data-sound="A4" src="pianomp3/A4.mp3"></audio>
                <audio data-sound="A#4" src="pianomp3/Bb4.mp3"></audio>
                <audio data-sound="B4" src="pianomp3/B4.mp3"></audio>
              </div>

              <div class="settings">
                
                <h4>Songs Will Play:</h4>
                <div class="behavior_controls">
                  <span>Manual</span>
                  <label class="switch">
                    <input class="switch_check" type="checkbox">
                    <span class="slider round"></span>
                  </label>
                  <span>Auto</span>
                </div>

                <div class="volume_controls">
                  <label class="songVolText">Song Volume: </label>
                  <input class="songVolInput" type="range" id="volume" value="100">
                  
                  <label class="pianoVolText">Piano Volume: </label>
                  <input class="pianoVolInput" type="range" id="volume2" value="100">
                </div>
              </div>

              <script>
                 let globalVol = 1;
                 let globalNoteVol = 1;
                 let globalPlayingStyle = 0;
                 let globalSongsPlayed = [];
                 const keys = document.querySelectorAll('.key, .black-key');

                 const songs = document.querySelectorAll('.song');
                 const songKeys = document.querySelectorAll('.keysWrapper > div');
                 const btn = document.querySelector('.stop_music');
                 const btn2 = document.querySelector('.start_music');
                 const btn3 = document.querySelector('.next_music');

                 volume.addEventListener("input", (e) => {
                    const currentSong = document.querySelector('div.playing');
                    let audio = document.querySelector(`audio[data-sound="${currentSong.dataset.song}"]`);
                      
                    audio.volume = e.currentTarget.value / 100;
                    globalVol = audio.volume;   
                });

                volume2.addEventListener("input", (e) => {
                    const currentKey = document.querySelector('.key');
                    
                    let audio = document.querySelector(`audio[data-sound="${currentKey.dataset.note}"]`);
                    
                    audio.volume = e.currentTarget.value / 100;
                    globalNoteVol = audio.volume;   
                });

                btn.addEventListener('click', () => {
                  const currentSong = document.querySelector('div.playing');
                  stopSong(currentSong.dataset.song);
                });

                function randomSong() {
                  if(globalSongsPlayed.length < 10) {
                     // console.log("CHECKED");
                     btn2.style.display = 'none';
                     btn3.style.display = 'block';
                      var randSong = Math. floor(Math. random()*10) + 1;

                      if(globalSongsPlayed.includes(randSong)) {
                        console.log("LENGTH: "+globalSongsPlayed.length);
                        randomSong();
                      } else {
                        playSong(randSong);
                        globalSongsPlayed.push(randSong);
                        console.log("VALIDO");
                        console.log(randSong);

                      }
                    } else {
                      console.log("NOT CHECKED");
                      console.log("STYLE: "+globalPlayingStyle);
                      console.log("LENGTH: "+globalSongsPlayed.length);
                      btn2.style.display = 'block';
                      btn3.style.display = 'none';
                    }
                }

                btn2.addEventListener('click', () => {
                  console.log("START GAME NOW");
                  
                  randomSong();
                });

                btn3.addEventListener('click', () => {
                 // console.log("START GAME NOW");
                  ///btn2.hide();
                  randomSong();
                });

                 function playSongAuto() {
                  console.log("PLAYING AUTOMATICALLY");
                 }

                 function playSound(note) {
                     const audio = document.querySelector(`audio[data-sound="${note}"]`);
                     if (!audio) return;
                     audio.currentTime = 0;
                     audio.volume = globalNoteVol;
                     audio.play();
                 }

                 function playSong(note) {
                     if (currPlaying = document.querySelector('div.playing')) {
                        stopSong(currPlaying.dataset.song);
                     };
                     
                     const audio = document.querySelector(`audio[data-sound="${note}"]`);
                     if (!audio) return;
                     audio.currentTime = 0;
                     audio.volume = globalVol;
                     audio.play();
                     const songPlaying = document.querySelector(`div[data-song="${note}"]`);
                     const songs = document.querySelectorAll('div.song');
                     songs.forEach(song => {
                        song.classList.remove('activa');
                     });

                     songPlaying.classList.add('playing');
                     songPlaying.classList.add('activa');
                    // document.querySelector("div.playing > i.fa").classList.remove("hide");
                     setTimeout(function (){

                      audio.pause();
                    //  document.querySelector("div.playing > i.fa").classList.add("hide");
                      songPlaying.classList.remove('playing');
                      }, 30000);
                 }

                 function stopSong(note) {
                    const audio = document.querySelector(`audio[data-sound="${note}"]`);
                    audio.pause();
                    const songPlaying = document.querySelector('div.playing');
                    songPlaying.classList.remove('playing');
                 }

                 songs.forEach(song => {
                    song.addEventListener('mousedown', () => {
                      const note = song.dataset.song;
                      playSong(note);
                    });
                 });

                 songKeys.forEach(key => {
                  key.addEventListener('mousedown', () => {
                      const currentSong = document.querySelector('div.activa');
                      const songPlaying = document.querySelector('div.playing');
                      const note = key.dataset.note;
                  if(currentSong != null) {
                        const currentKey = currentSong.dataset.note;
                        const song = currentSong.dataset.song;
                        if(note == currentKey) {
                          key.classList.add('right');
                          songKeys.forEach(key1 => {
                            if(key != key1) {key1.classList.remove('wrong');}
                          });
                          if(songPlaying != null) {
                            stopSong(song);
                          }
                          setTimeout(function (){
                              key.classList.remove('right');
                              randomSong();
                          }, 600);
                         } else {
                          key.classList.add('wrong');
                         }
                      }
                 });

                 key.addEventListener('touchstart', () => {
                    /* use if you need something to be only on TOUCH. if nothing here TOUCH uses MOUSEDOWN above*/
                 });
                });

                 keys.forEach(key => {
                    
                     key.addEventListener('mousedown', () => {
                      const currentSong = document.querySelector('div.playing');
                         const note = key.dataset.note;
                         playSound(note);
                         key.classList.add('active');
                     });

                     key.addEventListener('mouseup', () => {
                         key.classList.remove('active');
                     });

                     key.addEventListener('mouseleave', () => {
                         key.classList.remove('active');
                     });

                     key.addEventListener('touchstart', (event) => {
                         const note = key.dataset.note;
                         playSound(note);
                         key.classList.add('active');
                         event.preventDefault();

                        
                     });

                     key.addEventListener('touchend', () => {
                         key.classList.remove('active');
                     });
                 });

                 window.addEventListener('keydown', (event) => {
                     const key = event.key.toUpperCase();
                     const keyElement = document.querySelector(`.key[data-note="${key}"]`);
                     if (!keyElement) return;
                     const note = keyElement.dataset.note;
                     playSound(note);
                     keyElement.classList.add('active');
                 });

                 window.addEventListener('keyup', (event) => {
                     const key = event.key.toUpperCase();
                     const keyElement = document.querySelector(`.key[data-note="${key}"]`);
                     if (!keyElement) return;
                     keyElement.classList.remove('active');
                 });

                const checkBox = document.querySelector("input.switch_check");
                checkBox.addEventListener('click', ()=> {
                    if(checkBox.checked) {
                      globalPlayingStyle = 1;
                    } else {
                      globalPlayingStyle = 0
                    }
                    console.log(globalPlayingStyle);
                });


             </script>

         </div>
     </div>
  </body>
</html>
